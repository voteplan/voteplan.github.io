<!DOCTYPE html>

<html>
    <head>
		<script>
			var heading = 'Hobart City Council Election 2018';
			var subheading = 'Councillors';
            var candidates = [
'ALEXANDER, Darren',
'ALLARDICE, Robin',
'BEHRAKIS, Simon',
'BLOOMFIELD, Louise',
'BRISCOE, Jeff',
'BURNET, Helen',
'CHRISTIE, Ron',
'COATS, Will',
'CORR, Brian',
'DENISON, Tanya',
'DUT, Salpha',
'DUTTA, Mike',
'EWIN, Holly',
'FRAME, Nigel',
'HARVEY, Bill',
'IRWIN, Fiona',
'McCALLUM, Stephen',
'MALLETT, Robert',
'MERRIDEW, Chris',
'NGOR, Atak',
'PEELMAN, Ben',
'REYNOLDS, Anna',
'ROFFE, Richard',
'SCHOFIELD, Cat',
'SEXTON, Peter',
'SHERLOCK, Zelinda',
'SIENA, Kasha',
'STANAWAY, Glen',
'STANSFIELD, Philip',
'TANG, Yongbei',
'TAYLOR, Andy (Tubes)',
'TAYLOR, Bec',
'THOMAS, Damon',
'VOGEL, Stefan',
'WALDHOFF, Martin',
'ZUCCO, Marti'
            ]

		var deputyLordMayorCandidates = [
'ALLARDICE, Robin',
'BEHRAKIS, Simon',
'BLOOMFIELD, Louise',
'BURNET, Helen',
'COATS, Will',
'MERRIDEW, Chris',
'ROFFE, Richard',
'SHERLOCK, Zelinda',
'STANSFIELD, Philip',
'TAYLOR, Andy (Tubes)',
'WALDHOFF, Martin'
        ]

		var lordMayorCandidates = [
'ALEXANDER, Darren',
'BRISCOE, Jeff',
'CHRISTIE, Ron',
'DENISON, Tanya',
'DUTTA, Mike',
'HARVEY, Bill',
'MALLETT, Robert',
'REYNOLDS, Anna',
'SEXTON, Peter',
'THOMAS, Damon',
'ZUCCO, Marti'
        ]
		</script>

        <script
            src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
            crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.6.1/Sortable.min.js"></script>

        <link href="https://fonts.googleapis.com/css?family=Open+Sans:600" rel="stylesheet">

        <style>
* {
    font-family: 'Open Sans', sans-serif;
    color: #111;
}

body {
    background-color: hsl(28, 18%, 92%);
    text-align: center;
}

h1 {
	margin: 10px 20px;
    font-size: 19px;
}

h2 {
	margin: 10px 20px;
    font-size: 24px;
    margin-bottom: 10px;
}

h3 {
	margin: 0;
}

ol#items {
    display: inline-block;
    margin-bottom: 10px;
    margin-right: auto;
    margin-left: auto;
}

ol#items li {
    text-align: left;
    padding: 4px 8px;
    border: 1px solid hsl(28, 10%, 82%);
    cursor: move;
    cursor: grab;
    background-color: #fff;
    width: 500px;
	white-space: nowrap;
}

.toggle {
    background-color: hsl(28, 10%, 75%) !important;
}

.toggle-span:before {
    content: "âœ” ";
}

.ghost {
    background-color: hsl(28, 7%, 60%) !important;
    position: relative;
}

.hovering {
    background-color: hsl(28, 10%, 82%) !important;
}

.instructions {
    width: 500px;
    margin: 0 auto;
    text-align: left;
	margin-top: 20px;
}

.instructions-list {
	margin-top: 10px;
}

.instructions-list li {
	margin: 15px 0;
}

input {
    width: 270px;
    margin-left: 10px;
    float: right;
    border: 1px solid hsl(28, 10%, 70%);
}

ol#lordMayorCandidatesList li,
ol#deputyLordMayorCandidatesList li,
ol#alphabeticalList li,
ol#alphabeticalLordMayorList li,
ol#alphabeticalDeputyLordMayorList li {
    text-align: left;
    width: 500px;
}


ol#lordMayorCandidatesList,
ol#deputyLordMayorCandidatesList,
ol#alphabeticalList,
ol#alphabeticalLordMayorList
ol#alphabeticalDeputyLordMayorList {
    display: inline-block;
}

.listDiv {
	margin: 15px auto;
	width: 500px;
	background-color: #fff;
	border-radius: 10px;
	border: 1px solid hsl(28, 10%, 82%);
}

.listContainerDiv {
	padding: 20px;
}

#headingDiv {
    background-color: hsl(28, 10%, 82%);
	display: table;
	margin: 0 auto;
	margin-top: 20px;
	border-radius: 10px;
}
        </style>

		<title>VotePlan - Hobart City Council Election 2018 - Councillors</title>
    </head>

    <body>

		<div id="headingDiv">
			<h1 id="heading"></h1>
			<h2 id="subheading"></h2>
		</div>

        <div class="instructions">
			<p>VotePlan is a tool for ordering candidates.</p>
            <ul class="instructions-list">
                <li>Drag names to order them (they start in alphabetical order).</li>
                <li>You can use the text boxes to add notes.</li>
                <li>You can click names to toggle a tick to remind yourself who you have ordered and who you have yet to order.</li>
				<li>Lists underneath for Lord Mayor and Deputy Lord Mayor will automatically change to be in the same order as your Councillor preferences.</li>
				<li>Additional lists underneath have the candidates in alphabetical order but with the same numbers as above to make finding candidate names on this page faster when you transfer numbers to your ballot paper.</li>
			</ul>
			<p>Send feedback to <a href="mailto:programming4politics@protonmail.com">programming4politics@protonmail.com</a></p>
        </div>

        <ol id="items"></ol>

		<div class="listDiv">
		<div class="listContainerDiv">
		<h3>Lord Mayor candidates in the order above</h3>
		<ol id="lordMayorCandidatesList"></ol>
		</div>
		</div>
		
		<div class="listDiv">
		<div class="listContainerDiv">
		<h3>Deputy Lord Mayor candidates in the order above</h3>
		<ol id="deputyLordMayorCandidatesList"></ol>
		</div>
		</div>

		<div class="listDiv">
		<div class="listContainerDiv">
		<h3>Councillor candidates in alphabetical order with the same numbers as above</h3>
		<ol id="alphabeticalList"></ol>
		</div>
		</div>
		
		<div class="listDiv">
		<div class="listContainerDiv">
		<h3>Lord Mayor candidates in alphabetical order with the same numbers as above</h3>
		<ol id="alphabeticalLordMayorList"></ol>
		</div>
		</div>
		
		<div class="listDiv">
		<div class="listContainerDiv">
		<h3>Deputy Lord Mayor candidates in alphabetical order with the same numbers as above</h3>
		<ol id="alphabeticalDeputyLordMayorList"></ol>
		</div>
		</div>
		
        <script>
		
$(document).prop('title', 'VotePlan - ' + heading + ' - ' + subheading);

$('#heading').text(heading);
$('#subheading').text(subheading);

var items = $('#items')
$.each(candidates, function(i) {
    var li = $('<li/>')
        .appendTo(items);
    var input = $('<input/>')
        .addClass('notes')
        .attr('placeholder', 'Notes')
        .appendTo(li);
    var span = $('<span/>')
        .addClass('name')
        .text(candidates[i])
        .appendTo(li);
});

var el = document.getElementById('items');
var canHover = true;
var sortable = Sortable.create(el, {
    ghostClass: 'ghost',
    onEnd: function (evt) {
        canHover = true;

		generateLists();
    },
    onChoose: function (evt) {
        canHover = false;
        $('ol#items li').removeClass('hovering');
    },
});

$('ol#items li').on('click', function(e){
	if (!$(e.target).hasClass('notes')) {
		$(this).toggleClass('toggle');
		$(this).children('span').first().toggleClass('toggle-span');
	}
    canHover = true;
});

$('.notes').focus(function(){
    canHover = true;
});

$('ol#items li').bind('mouseenter', function(){
    if (canHover) {
        $(this).addClass('hovering');
    }
}).bind('mouseleave', function(){
    $(this).removeClass('hovering');
});

document.documentElement.addEventListener('mouseup', function(e){
	canHover = true;
});

function generateLists() {
	var newLordMayorList = $('<ol/>').attr('id', 'lordMayorCandidatesList');
	var newDeputyLordMayorList = $('<ol/>').attr('id', 'deputyLordMayorCandidatesList');
	$('ol#items li').each(function() {
		if (lordMayorCandidates.includes($(this).text())) {
			$('<li/>').text($(this).text()).appendTo(newLordMayorList);
		}
		if (deputyLordMayorCandidates.includes($(this).text())) {
			$('<li/>').text($(this).text()).appendTo(newDeputyLordMayorList);
		}
	});

	$('#lordMayorCandidatesList').replaceWith(newLordMayorList);
	$('#deputyLordMayorCandidatesList').replaceWith(newDeputyLordMayorList);

	function generateAlphabeticalList(selector, id) {
		var alphabeticalNamesList = $('<ol/>').attr('id', id);

		var alphabeticalNames = [];

		$(selector).each(function(i) {
			alphabeticalNames.push({
				"name": $(this).text(),
				"value": i + 1
			})
		});

		alphabeticalNames.sort(function (a, b) {
			return a.name.localeCompare(b.name);
		});

		for (var i = 0; i < alphabeticalNames.length; i++) {
			$('<li/>')
				.text(alphabeticalNames[i].name)
				.attr('value', alphabeticalNames[i].value)
				.appendTo(alphabeticalNamesList);
		}

		$('#'+id).replaceWith(alphabeticalNamesList);
	}
	
	generateAlphabeticalList('ol#items li', 'alphabeticalList');
	generateAlphabeticalList('ol#lordMayorCandidatesList li', 'alphabeticalLordMayorList');
	generateAlphabeticalList('ol#deputyLordMayorCandidatesList li', 'alphabeticalDeputyLordMayorList');
}

generateLists();

        </script>
        <body>
</html>
